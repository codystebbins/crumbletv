"use strict";var app=angular.module("basilApp",["ngCookies","ngSanitize","ui.router","restangular"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/main.html",controller:"mainController"}).state("watch",{url:"/watch",templateUrl:"views/watch.html",controller:"streamController"}).state("sign-up",{url:"/sign-up",templateUrl:"views/sign-up.html",controller:"signUpController"}).state("subscribe",{url:"/subscribe",templateUrl:"views/subscribe.html",controller:"subscribeController"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginController"}).state("session",{url:"/session",templateUrl:"views/session.html",controller:"sessionController"})}]);app.config(["RestangularProvider",function(a){a.setBaseUrl("http://localhost:1337"),a.setResponseExtractor(function(a){return a.data}),a.setDefaultHttpFields({cache:!0}),a.setDefaultHeaders({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"})}]),angular.module("basilApp").controller("menuController",["$scope","authService","gravatarService",function(a,b,c){a.name=!1,a.avatar=!1,b.getName().then(function(b){a.name=b},function(){console.log("We are not logged in"),a.name=!1}),a.$watch(function(){return b.name},function(b){"undefined"!=typeof b&&null!==b&&(a.name=b,console.log(a.avatar,b),0==a.avatar&&0!=b&&(console.log("Getting avatar"),c.getGravatar(b).then(function(b){a.avatar=b})))})}]),angular.module("basilApp").controller("mainController",["$scope","facetService",function(a,b){b.getListGroupedByParentFacet().then(function(b){a.facets=b}),a.facetService=b,a.otherVideos=[{title:"Title 1",user:"username1",subs:55,thumb:"http://placehold.it/100x100"},{title:"Title 2",user:"username2",subs:64,thumb:"http://placehold.it/100x100"},{title:"Title 3",user:"username3",subs:9001,thumb:"http://placehold.it/100x100"}],a.subscriptions=["Evan","Jace","Thomas","Janella","Evan's Mom","Carlo"],a.scheduledStreams=[{name:"Name 1",date:"November 13, 2014",attending:25},{name:"Name 2",date:"November 14, 2014",attending:9e3},{name:"Name 2",date:"November 14, 2014",attending:31}]}]),angular.module("basilApp").controller("streamController",["$scope",function(a){a.streamName="evan"}]),angular.module("basilApp").controller("signUpController",["$scope","$state","Restangular",function(a,b,c){a.name="",a.email="",a.password="",a.success="FALSE",a.createUser=function(){var d={name:a.name,email:a.email,password:a.password};c.all("User").post(d).then(function(c){console.log(c),a.success="TRUE",b.go("login")},function(a){alert("Something went wrong",a)})}}]),angular.module("basilApp").controller("subscribeController",["$scope","Restangular",function(a,b){a.username="",a.subTo="",a.success="FALSE",a.createSubscription=function(){var c={subscriber:a.username,subscriberPayee:a.subTo};console.log(c),b.all("Subscription").post(c).then(function(b){console.log(b),a.success="TRUE"})}}]),angular.module("basilApp").controller("loginController",["$scope","Restangular","gravatarService","authService",function(a,b,c,d){a.email="",a.password="",a.success="FALSE",a.avatar="http://placehold.it/80x80",a.login=function(){d.authenticate(a.email,a.password).then(function(b){c.getGravatar(b.name).then(function(b){a.avatar=b}),a.success="SUCCESS"},function(){console.log("Could not authenticate")})}}]),angular.module("basilApp").controller("sessionController",["$scope","Restangular",function(a,b){a.success="FALSE",console.log("Controller loaded"),a.checkSession=function(){console.log("Checking session"),b.all("user").one("me").get().then(function(b){console.log(b),a.success="TRUE"})}}]),angular.module("basilApp").service("facetService",["Restangular","$q",function(a,b){function c(){return g.getList()}function d(){var a=b.defer();return c().then(function(b){a.resolve(_.groupBy(b,function(a){return a.parent_facet}))}),a.promise}function e(a){return f[a]}var f,g=a.all("facet");return d().then(function(a){f=_.indexBy(a[null],"id"),console.log(f)}),{getList:c,getListGroupedByParentFacet:d,getParentFacet:e}}]),angular.module("basilApp").service("gravatarService",["Restangular","$q",function(a,b){function c(c,e){var e=e||80,f=b.defer();return"undefined"!=typeof d.stored[c]&&f.resolve(d.stored[c]+"?s="+e),a.all("gravatar").one("get",c).get().then(function(a){d.stored[c]=a.image,f.resolve(d.stored[c]+"?s="+e)}),f.promise}var d={init:!0,stored:{}};return{getGravatar:c}}]),angular.module("basilApp").service("authService",["Restangular","$q",function(a,b){var c={name:null};return c.authenticate=function(c,d){var e=this,f=b.defer();return a.all("user/login").post({email:c,password:d}).then(function(a){"undefined"!=typeof a&&(e.name=a.name,f.resolve(a)),f.reject(a)},function(a){console.log(a),f.reject(a)}),f.promise},c.getName=function(){var c=this,d=b.defer();return a.one("user","me").get().then(function(a){"undefined"!=typeof a&&(c.name=a.name,d.resolve(a.name)),d.reject("User is not logged in")}),d.promise},c.logout=function(){var c=b.defer();return a.one("user","logout").get().then(function(a){c.resolve(a)}),c.promise},c}]),angular.module("basilApp").directive("videoPlayer",[function(){function a(a){var b=angular.copy(c);return b.clip.url=a,b}var b="/static/flash/flowplayer",c={clip:{url:"myurl",live:!0,provider:"influxis"},plugins:{influxis:{url:b+".rtmp-3.2.13.swf",netConnectionUrl:"rtmp://162.243.130.104:1935/videochat"}}};return{restrict:"C",scope:{name:"="},link:function(c,d){flowplayer(d[0],b+"-3.2.18.swf",a(c.name))}}}]);